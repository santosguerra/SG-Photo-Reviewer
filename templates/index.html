<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photo Reviewer</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="app-container">
        <!-- Header with tabs -->
        <header class="header">
            <div class="app-header">
                <div class="tabs">
                    <button class="tab" data-tab="config">Configuraci√≥n</button>
                    <button class="tab active" data-tab="reviewer" id="reviewer-tab">Navegar</button>
                    <button class="tab" data-tab="help">Ayuda</button>
                </div>
                <div class="app-info">
                    <span id="app-version">SG Photo Reviewer v1.0.6</span>
                    <button id="shortcuts-btn" class="btn-shortcuts" title="Atajos de teclado">?</button>
                </div>
            </div>
        </header>

        <!-- Config Tab -->
        <div class="tab-content" id="config-tab">
            <div class="config-container">
                <section class="config-section">
                    <h2>Puntos de Montaje</h2>
                    <div id="mount-points-list"></div>
                    <div class="input-group">
                        <input type="text" id="new-mount-point" placeholder="/ruta/al/montaje">
                        <button id="add-mount-point">Agregar</button>
                    </div>
                </section>

                <section class="config-section">
                    <h2>Carpeta de Destino</h2>
                    <div class="input-group">
                        <input type="text" id="destination-folder" placeholder="para-revision">
                    </div>
                </section>

                <section class="config-section">
                    <h2>Opciones de Eliminaci√≥n</h2>
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" id="enable-delete-button">
                            <span>Habilitar bot√≥n de eliminar</span>
                        </label>
                    </div>
                    <p class="config-note">Permite eliminar archivos definitivamente. Por defecto solo activo en carpeta de revisi√≥n.</p>
                </section>

                <button id="save-config" class="btn-primary">Guardar Configuraci√≥n</button>

                <section class="config-section">
                    <h2>Diagn√≥stico de Permisos</h2>
                    <div id="permissions-diagnostic"></div>
                </section>
            </div>
        </div>

        <!-- Reviewer Tab -->
        <div class="tab-content active" id="reviewer-tab-content">
            <div class="reviewer-container">
                <!-- Panel Dual de Navegaci√≥n -->
                <div id="revisor-panel">
                    <!-- Breadcrumb Bar -->
                    <div class="breadcrumb-bar">
                        <button id="back-btn" class="btn-back">‚Üê Atr√°s</button>
                        <button id="history-back" class="btn-history" title="Retroceder en historial" disabled>‚óÄ</button>
                        <button id="history-forward" class="btn-history" title="Avanzar en historial" disabled>‚ñ∂</button>
                        <button id="toggle-bookmark" class="btn-bookmark" title="Agregar/Quitar favorito">‚òÜ</button>
                        <div class="bookmarks-dropdown" id="bookmarks-dropdown">
                            <button class="btn-bookmarks-toggle" id="bookmarks-toggle">‚òÖ Favoritos <span id="bookmarks-count">(0)</span></button>
                            <div class="bookmarks-list" id="bookmarks-list" style="display: none;"></div>
                        </div>
                        <div id="breadcrumb-path"></div>
                    </div>

                    <!-- Panel de Subcarpetas -->
                    <div id="folders-panel" class="panel-section">
                        <div class="panel-header">
                            <span>üìÅ SUBCARPETAS (<span id="folder-count">0</span>)</span>
                            <button id="toggle-folders" class="btn-toggle">‚ñº Colapsar</button>
                        </div>
                        <div id="folders-grid" class="folders-grid"></div>
                    </div>

                    <!-- Panel de Fotos -->
                    <div id="photos-panel" class="panel-section">
                        <div class="panel-header">
                            <span>üì∑ FOTOS (<span id="photo-count">0</span>)</span>
                            <div class="photo-controls">
                                <span id="marked-count">0 marcadas</span>
                                <button id="mark-all" class="btn">Seleccionar todas</button>
                                <button id="unmark-all" class="btn">Desmarcar todas</button>
                                <button id="delete-jpgs" class="btn-warning" style="display: none;">Eliminar JPGs (mantener RAW)</button>
                                <button id="move-photos" class="btn-primary" style="display: none;">Mover 0 fotos a revisi√≥n</button>
                                <button id="restore-photos" class="btn-primary" style="display: none;">Restaurar 0 fotos</button>
                                <button id="delete-photos" class="btn-danger" style="display: none;">Eliminar 0 fotos definitivamente</button>
                            </div>
                        </div>
                        <div id="photos-grid" class="photos-grid"></div>
                    </div>
                </div>

                <!-- Carousel View -->
                <div class="carousel-view" id="carousel-view">
                    <button class="carousel-close" id="carousel-close">‚úï Cerrar</button>
                    <button class="carousel-nav prev" id="carousel-prev">‚Äπ</button>
                    <div class="carousel-content">
                        <img id="carousel-image" src="" alt="Photo" style="display: none;">
                        <video id="carousel-video" controls style="display: none;"></video>
                        <div class="carousel-badges" id="carousel-badges"></div>
                        <!-- Metadata panel -->
                        <div class="carousel-metadata" id="carousel-metadata">
                            <div class="metadata-item"><strong>Archivo:</strong> <span id="meta-filename">-</span></div>
                            <div class="metadata-item"><strong>Tama√±o:</strong> <span id="meta-filesize">-</span></div>
                            <div class="metadata-item"><strong>Dimensiones:</strong> <span id="meta-dimensions">-</span></div>
                            <div class="metadata-item"><strong>Fecha:</strong> <span id="meta-date">-</span></div>
                            <div class="metadata-item"><strong>C√°mara:</strong> <span id="meta-camera">-</span></div>
                            <div class="metadata-item"><strong>Exposici√≥n:</strong> <span id="meta-exposure">-</span></div>
                        </div>
                        <!-- Loading overlay for carousel -->
                        <div id="carousel-loading-overlay" class="carousel-loading-overlay" style="display: none;">
                            <div class="loading-content">
                                <span>Cargando imagen</span>
                                <span class="loading-dots">
                                    <span>.</span><span>.</span><span>.</span>
                                </span>
                            </div>
                        </div>
                    </div>
                    <button class="carousel-nav next" id="carousel-next">‚Ä∫</button>
                    <div class="carousel-info">
                        <span id="carousel-counter">Foto 0 de 0 - 0 marcadas</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Help Tab -->
        <div class="tab-content" id="help-tab">
            <div class="config-container">
                <section class="config-section">
                    <h2>üéØ ¬øQu√© hace este programa?</h2>
                    <p>Photo Reviewer es una herramienta profesional para organizar sesiones fotogr√°ficas. Te ayuda a identificar y descartar r√°pidamente im√°genes borrosas, movidas o desenfocadas. Puedes revisar cientos de fotos en minutos, liberar espacio en tu servidor y gestionar archivos RAW y JPG simult√°neamente.</p>
                </section>

                <section class="config-section">
                    <h2>üöÄ ¬øC√≥mo funciona?</h2>
                    <ol class="help-list">
                        <li>Navega hasta la carpeta de tu sesi√≥n fotogr√°fica usando el explorador</li>
                        <li>Visualiza todas las fotos en modo grilla o carrusel</li>
                        <li>Marca las fotos que quieres descartar (click, Espacio, o Shift+Click para rangos)</li>
                        <li>Revisa el contador de espacio en disco de las fotos marcadas</li>
                        <li>Mueve las marcadas a la carpeta de revisi√≥n</li>
                        <li>Entra a la carpeta de revisi√≥n para confirmar eliminaci√≥n definitiva o restaurar</li>
                        <li>Las carpetas de revisi√≥n vac√≠as se eliminan autom√°ticamente</li>
                    </ol>
                </section>

                <section class="config-section">
                    <h2>‚ú® Novedades v1.1.x</h2>
                    <div class="help-features">
                        <h3>Mejoras de Selecci√≥n</h3>
                        <ul class="help-list">
                            <li><strong>Seleccionar todas:</strong> Marca todas las fotos visibles con un solo click</li>
                            <li><strong>Selecci√≥n por rango:</strong> Mant√©n Shift y haz click en dos fotos para marcar todo el rango entre ellas</li>
                            <li><strong>Contador de espacio:</strong> Ve cu√°nto espacio liberar√°s (MB/GB) antes de eliminar</li>
                        </ul>

                        <h3>Navegaci√≥n Mejorada</h3>
                        <ul class="help-list">
                            <li><strong>Historial de navegaci√≥n (‚óÄ ‚ñ∂):</strong> Funciona como un navegador web, navega hacia atr√°s y adelante en tu historial</li>
                            <li><strong>Favoritos (‚òÜ/‚òÖ):</strong> Guarda tus carpetas favoritas para acceso r√°pido</li>
                            <li><strong>Breadcrumb interactivo:</strong> Click en cualquier parte del path para navegar</li>
                        </ul>

                        <h3>Usabilidad</h3>
                        <ul class="help-list">
                            <li><strong>Modal de atajos:</strong> Presiona ? o H para ver todos los atajos de teclado disponibles</li>
                            <li><strong>Eliminaci√≥n simplificada:</strong> Ya no necesitas escribir "DELETE", solo confirma con un click</li>
                            <li><strong>Limpieza autom√°tica:</strong> Las carpetas de revisi√≥n vac√≠as se eliminan autom√°ticamente</li>
                        </ul>
                    </div>
                </section>

                <section class="config-section">
                    <h2>üìÅ Formatos soportados</h2>

                    <h3>Im√°genes RAW</h3>
                    <table class="help-table">
                        <thead>
                            <tr>
                                <th>Marca</th>
                                <th>Extensiones</th>
                                <th>Modelos t√≠picos</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Canon</td>
                                <td>.CR2, .CR3</td>
                                <td>EOS R, 5D, 6D, 7D, 80D, etc</td>
                            </tr>
                            <tr>
                                <td>Sony</td>
                                <td>.ARW</td>
                                <td>A7, A7R, A6000, A6400, etc</td>
                            </tr>
                            <tr>
                                <td>Nikon</td>
                                <td>.NEF</td>
                                <td>D850, D750, Z6, Z7, Z9, etc</td>
                            </tr>
                            <tr>
                                <td>Pentax</td>
                                <td>.PEF</td>
                                <td>K-1, K-3, K-70, etc</td>
                            </tr>
                            <tr>
                                <td>DJI</td>
                                <td>.DNG</td>
                                <td>Mavic, Phantom, Inspire, etc</td>
                            </tr>
                            <tr>
                                <td>Fujifilm</td>
                                <td>.RAF</td>
                                <td>X-T, X-Pro, X-H, GFX, etc</td>
                            </tr>
                            <tr>
                                <td>Olympus</td>
                                <td>.ORF</td>
                                <td>OM-D, PEN, E-M1, etc</td>
                            </tr>
                        </tbody>
                    </table>

                    <h3>Videos</h3>
                    <ul class="help-list">
                        <li><strong>.MP4</strong> - MPEG-4 (m√°s com√∫n)</li>
                        <li><strong>.MOV</strong> - QuickTime (Apple, c√°maras profesionales)</li>
                        <li><strong>.MKV</strong> - Matroska (alta calidad)</li>
                        <li><strong>.AVI</strong> - Audio Video Interleave</li>
                        <li><strong>.M4V</strong> - MPEG-4 Video (iTunes)</li>
                    </ul>

                    <h3>Im√°genes JPG</h3>
                    <ul class="help-list">
                        <li><strong>.JPG / .JPEG</strong> - Compatible con todos los archivos RAW</li>
                    </ul>
                </section>

                <section class="config-section">
                    <h2>‚å®Ô∏è Atajos de teclado</h2>
                    <p><em>Presiona <kbd>?</kbd> o <kbd>H</kbd> en cualquier momento para ver este panel de atajos</em></p>

                    <div class="keyboard-shortcuts">
                        <h3>Navegaci√≥n General</h3>
                        <ul class="help-list">
                            <li><kbd>?</kbd> o <kbd>H</kbd> : Mostrar panel de atajos de teclado</li>
                            <li><kbd>Esc</kbd> : Cerrar modales o salir del carrusel</li>
                        </ul>

                        <h3>Vista Carrusel</h3>
                        <ul class="help-list">
                            <li><kbd>‚Üê</kbd> <kbd>‚Üí</kbd> : Navegar entre fotos anterior/siguiente</li>
                            <li><kbd>Espacio</kbd> : Marcar/desmarcar foto actual</li>
                            <li><kbd>G</kbd> : Volver a vista grilla</li>
                            <li><kbd>Esc</kbd> : Salir del carrusel</li>
                        </ul>

                        <h3>Selecci√≥n de Fotos (Vista Grilla)</h3>
                        <ul class="help-list">
                            <li><kbd>Click</kbd> : Marcar/desmarcar foto individual</li>
                            <li><kbd>Shift</kbd> + <kbd>Click</kbd> : Seleccionar rango de fotos</li>
                            <li><strong>Bot√≥n "Seleccionar todas"</strong> : Marcar todas las fotos visibles</li>
                            <li><strong>Bot√≥n "Desmarcar todas"</strong> : Desmarcar todas las fotos</li>
                        </ul>
                    </div>
                </section>

                <section class="config-section">
                    <h2>üé® Caracter√≠sticas principales</h2>

                    <h3>Sistema de Navegaci√≥n</h3>
                    <ul class="help-list">
                        <li><strong>Breadcrumb interactivo:</strong> Click en cualquier carpeta del path para navegar directamente</li>
                        <li><strong>Bot√≥n "‚Üê Atr√°s":</strong> Sube un nivel en la jerarqu√≠a de carpetas</li>
                        <li><strong>Historial (‚óÄ ‚ñ∂):</strong> Navega hacia atr√°s y adelante en tu historial de navegaci√≥n</li>
                        <li><strong>Panel de subcarpetas:</strong> Ve y navega las subcarpetas de la carpeta actual</li>
                        <li><strong>Contador de carpetas y fotos:</strong> Informaci√≥n en tiempo real</li>
                    </ul>

                    <h3>Sistema de Favoritos</h3>
                    <ul class="help-list">
                        <li><strong>Bot√≥n ‚òÜ/‚òÖ:</strong> Agrega o quita la carpeta actual de favoritos</li>
                        <li><strong>Dropdown "‚òÖ Favoritos":</strong> Lista de todas tus carpetas favoritas</li>
                        <li><strong>Navegaci√≥n r√°pida:</strong> Click en cualquier favorito para ir directo</li>
                        <li><strong>Eliminar favoritos:</strong> Bot√≥n √ó en cada favorito para quitarlo</li>
                        <li><strong>Persistencia:</strong> Los favoritos se guardan autom√°ticamente en tu navegador</li>
                    </ul>

                    <h3>Gesti√≥n de Archivos</h3>
                    <ul class="help-list">
                        <li><strong>Detecci√≥n autom√°tica JPG+RAW:</strong> Identifica pares de archivos autom√°ticamente</li>
                        <li><strong>Badges visuales:</strong> JPG+RAW (verde), Solo JPG (naranja), Solo RAW (azul), VIDEO (morado)</li>
                        <li><strong>Marca de c√°mara:</strong> Identifica Canon, Sony, Nikon, etc.</li>
                        <li><strong>Contador de espacio:</strong> Muestra el tama√±o total de archivos marcados (MB/GB)</li>
                        <li><strong>Thumbnails optimizados:</strong> Carga r√°pida con lazy loading</li>
                        <li><strong>Nombres de archivo:</strong> Visibles debajo de cada thumbnail</li>
                    </ul>

                    <h3>Operaciones de Archivos</h3>
                    <ul class="help-list">
                        <li><strong>Mover a revisi√≥n:</strong> Mueve JPG, RAW y videos juntos a carpeta de revisi√≥n</li>
                        <li><strong>Restaurar:</strong> Devuelve archivos de carpeta de revisi√≥n a carpeta original</li>
                        <li><strong>Eliminar JPGs (mantener RAW):</strong> √ötil para ahorrar espacio manteniendo RAW</li>
                        <li><strong>Eliminar definitivamente:</strong> Borra archivos permanentemente (solo en carpeta de revisi√≥n)</li>
                        <li><strong>Limpieza autom√°tica:</strong> Carpetas de revisi√≥n vac√≠as se eliminan autom√°ticamente</li>
                    </ul>

                    <h3>Vistas y Visualizaci√≥n</h3>
                    <ul class="help-list">
                        <li><strong>Vista Grilla:</strong> Visualiza muchas fotos simult√°neamente con thumbnails</li>
                        <li><strong>Vista Carrusel:</strong> Visualiza fotos en tama√±o completo una por una</li>
                        <li><strong>Lazy loading:</strong> Carga progresiva de fotos para mejor rendimiento</li>
                        <li><strong>Reproductor de video:</strong> Reproduce videos directamente en el carrusel</li>
                        <li><strong>Panel colapsable:</strong> Oculta el panel de subcarpetas cuando no lo necesites</li>
                    </ul>
                </section>

                <section class="config-section">
                    <h2>üí° Tips y trucos</h2>
                    <ul class="help-list">
                        <li><strong>Shift+Click para rapidez:</strong> Marca tu primera foto mala, despl√°zate hasta la √∫ltima mala de la secuencia y Shift+Click para marcar todo el rango</li>
                        <li><strong>Usa favoritos:</strong> Guarda tus carpetas de trabajo frecuentes para acceso instant√°neo</li>
                        <li><strong>Revisa el espacio:</strong> Antes de eliminar, verifica cu√°nto espacio liberar√°s en el contador</li>
                        <li><strong>Elimina JPGs primero:</strong> Si tienes RAW+JPG, elimina solo los JPGs para ahorrar espacio y mantener calidad</li>
                        <li><strong>Carpeta de revisi√≥n como buffer:</strong> Mueve fotos a revisi√≥n para una segunda opini√≥n antes de eliminar definitivamente</li>
                        <li><strong>Historial de navegaci√≥n:</strong> Usa ‚óÄ ‚ñ∂ para navegar entre carpetas que acabas de visitar</li>
                        <li><strong>Atajos de teclado:</strong> Presiona ? para recordar todos los atajos disponibles</li>
                    </ul>
                </section>

                <section class="config-section">
                    <h2>‚ö†Ô∏è Advertencias importantes</h2>
                    <ul class="help-list">
                        <li><strong>Eliminaci√≥n permanente:</strong> Los archivos eliminados NO van a la papelera de reciclaje</li>
                        <li><strong>Carpeta de revisi√≥n:</strong> Usa siempre la carpeta de revisi√≥n antes de eliminar definitivamente</li>
                        <li><strong>Backups:</strong> Mant√©n siempre backups de tus archivos originales en otro lugar</li>
                        <li><strong>Permisos:</strong> Aseg√∫rate de tener permisos de lectura/escritura en todas las carpetas</li>
                        <li><strong>RAW+JPG pareados:</strong> Al eliminar, mover o restaurar, ambos archivos se procesan juntos</li>
                    </ul>
                </section>

                <section class="config-section">
                    <h2>üìù Changelog</h2>

                    <h3>v1.1.2 (2025-10-19)</h3>
                    <ul class="help-list">
                        <li>Actualizaci√≥n completa de documentaci√≥n de ayuda</li>
                        <li>13 secciones de documentaci√≥n profesional</li>
                        <li>Tips, trucos y advertencias</li>
                        <li>Changelog visible en pesta√±a de ayuda</li>
                    </ul>

                    <h3>v1.1.1 (2025-10-19)</h3>
                    <ul class="help-list">
                        <li>Correcci√≥n de sistema de versionado (+0.0.1 por cambio)</li>
                    </ul>

                    <h3>v1.1.0 (2025-10-19) - Mejoras significativas de UX/UI</h3>
                    <h4>Correcciones</h4>
                    <ul class="help-list">
                        <li>Modal de eliminaci√≥n simplificado (sin necesidad de escribir "DELETE")</li>
                        <li>Agregado bot√≥n "Seleccionar todas" para marcar todas las fotos visibles</li>
                        <li>Carpetas de revisi√≥n vac√≠as se eliminan autom√°ticamente</li>
                    </ul>

                    <h4>Nuevas caracter√≠sticas</h4>
                    <ul class="help-list">
                        <li>Selecci√≥n por rango con Shift+Click</li>
                        <li>Contador de espacio en disco (MB/GB) para fotos marcadas</li>
                        <li>Modal de atajos de teclado (bot√≥n ? o tecla H)</li>
                        <li>Historial de navegaci√≥n con botones ‚óÄ ‚ñ∂ (como navegador web)</li>
                        <li>Sistema de favoritos/bookmarks para carpetas frecuentes</li>
                    </ul>

                    <h3>v1.0.7 (2025-10-16) - Soporte de videos</h3>
                    <ul class="help-list">
                        <li>Agregado soporte completo para videos (MP4, MOV, MKV, AVI, M4V)</li>
                        <li>Generaci√≥n de thumbnails con OpenCV (primer frame)</li>
                        <li>Endpoint /api/video para streaming</li>
                        <li>Integrado en funciones move, restore, delete</li>
                    </ul>
                </section>
            </div>
        </div>

        <!-- Loading indicator -->
        <div id="loading" class="loading" style="display: none;">
            <div class="spinner"></div>
        </div>

        <!-- Toast notifications -->
        <div id="toast" class="toast"></div>

        <!-- Delete confirmation modal -->
        <div id="delete-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <h2>‚ö†Ô∏è Eliminar archivos</h2>
                <p id="delete-modal-message">Vas a eliminar X archivos PERMANENTEMENTE. Esta acci√≥n es IRRECUPERABLE.</p>
                <div class="modal-buttons">
                    <button id="delete-cancel" class="btn">Cancelar</button>
                    <button id="delete-confirm" class="btn-danger">Eliminar definitivamente</button>
                </div>
            </div>
        </div>

        <!-- Delete JPGs confirmation modal -->
        <div id="delete-jpgs-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <h2>¬øEliminar JPGs (mantener RAW)?</h2>
                <p id="delete-jpgs-modal-message"></p>
                <div class="modal-buttons">
                    <button id="delete-jpgs-cancel" class="btn">Cancelar</button>
                    <button id="delete-jpgs-confirm" class="btn-warning">Eliminar JPGs</button>
                </div>
            </div>
        </div>

        <!-- Keyboard shortcuts modal -->
        <div id="shortcuts-modal" class="modal" style="display: none;">
            <div class="modal-content shortcuts-modal-content">
                <button class="shortcuts-close" id="shortcuts-close">√ó</button>
                <h2>‚å®Ô∏è Atajos de Teclado</h2>

                <div class="shortcuts-section">
                    <h3>Navegaci√≥n</h3>
                    <div class="shortcut-item">
                        <kbd>‚Üê</kbd> <kbd>‚Üí</kbd>
                        <span>Navegar entre carpetas / fotos en carrusel</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>Esc</kbd>
                        <span>Salir del carrusel / Cerrar modales</span>
                    </div>
                </div>

                <div class="shortcuts-section">
                    <h3>Vista Carrusel</h3>
                    <div class="shortcut-item">
                        <kbd>‚Üê</kbd> <kbd>‚Üí</kbd>
                        <span>Foto anterior / siguiente</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>Espacio</kbd>
                        <span>Marcar / desmarcar foto actual</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>G</kbd>
                        <span>Volver a vista grilla</span>
                    </div>
                </div>

                <div class="shortcuts-section">
                    <h3>Selecci√≥n de Fotos</h3>
                    <div class="shortcut-item">
                        <kbd>Click</kbd>
                        <span>Marcar / desmarcar foto</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>Shift</kbd> + <kbd>Click</kbd>
                        <span>Seleccionar rango de fotos</span>
                    </div>
                </div>

                <div class="shortcuts-section">
                    <h3>Ayuda</h3>
                    <div class="shortcut-item">
                        <kbd>?</kbd> o <kbd>H</kbd>
                        <span>Mostrar este panel de atajos</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
